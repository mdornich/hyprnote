# https://docs.netlify.com/build/configure-builds/overview/#definitions
# We must set package="apps/web" in the UI
[build]
command = "VITE_APP_VERSION=$COMMIT_REF pnpm -F @hypr/web build"
publish = "apps/web/dist/client"
ignore = "git diff --quiet $CACHED_COMMIT_REF $COMMIT_REF apps/web packages/api-client packages/tiptap packages/ui packages/utils package.json pnpm-lock.yaml"

[build.environment]
VITE_APP_URL = "https://char.com"
NODE_VERSION = "22"

[images]
# https://docs.netlify.com/build/image-cdn/overview/#remote-path
remote_images = [
  "https://char\\.com/.*",
  "https://hyprnote\\.com/.*",
  "https://ijoptyyjrfqwaqhyxkxj\\.supabase\\.co/.*",
]

# Domain migration: hyprnote.com -> char.com (301 for SEO)
# Exclude /admin, /app, /api, /webhook from redirects.
# Auth paths MUST redirect so PKCE cookies stay on one domain.

[[redirects]]
from = "https://hyprnote.com/auth"
to = "https://char.com/auth"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com/callback/*"
to = "https://char.com/callback/:splat"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com/blog/*"
to = "https://char.com/blog/:splat"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com/docs/*"
to = "https://char.com/docs/:splat"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com/changelog/*"
to = "https://char.com/changelog/:splat"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com/gallery/*"
to = "https://char.com/gallery/:splat"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com/integrations/*"
to = "https://char.com/integrations/:splat"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com/legal/*"
to = "https://char.com/legal/:splat"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com/jobs/*"
to = "https://char.com/jobs/:splat"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com/roadmap/*"
to = "https://char.com/roadmap/:splat"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com/vs/*"
to = "https://char.com/vs/:splat"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com/product/*"
to = "https://char.com/product/:splat"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com/solution/*"
to = "https://char.com/solution/:splat"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com/company-handbook/*"
to = "https://char.com/company-handbook/:splat"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com/press-kit/*"
to = "https://char.com/press-kit/:splat"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com/download"
to = "https://char.com/download"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com/pricing"
to = "https://char.com/pricing"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com/about"
to = "https://char.com/about"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com/opensource"
to = "https://char.com/opensource"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com/enterprise"
to = "https://char.com/enterprise"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com/security"
to = "https://char.com/security"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com/free"
to = "https://char.com/free"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com/contact"
to = "https://char.com/contact"
status = 301
force = true

[[redirects]]
from = "https://hyprnote.com"
to = "https://char.com"
status = 301
force = true

[[redirects]]
from = "https://getchar.com/*"
to = "https://char.com/:splat"
status = 301
force = true

[[redirects]]
from = "https://www.getchar.com/*"
to = "https://char.com/:splat"
status = 301
force = true

[[redirects]]
from = "http://getchar.com/*"
to = "https://char.com/:splat"
status = 301
force = true

[[redirects]]
from = "http://www.getchar.com/*"
to = "https://char.com/:splat"
status = 301
force = true
